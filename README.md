# ITentikaTest
![architecture](https://github.com/AntonZyuzin/ITentikaTest/assets/71172648/41df2753-3322-45b1-ae62-e888e31d6c15)


# Настройка БД:
Для запуска базы данных с помощью code first необходимо выполнить следующие команды в PM console:
- EntityFrameworkCore\Enable-migration
- EntityFrameworkCore\Add-Migration MigrationName
- EntityFrameworkCore\Update-Database

Класс для настройки DbContext:
ITentikaTest\Domain\Data\AppDbContext.cs


# Условие тестового задания:
Цель: Разработать систему генерации и обработки событий, с последующей генерацией и хранением инцидентов на основании их.
(например, инциденты системы безопасности на основе событий от камер, датчиков и пр.)

Разработать сервисы с использование Asp Net Core (Net 6), Ef Core
- сервис 1: Генератор событий
- сервис 2: Процессор событий
* оба должны запускать автоматически и работать постоянно (т.е. BackgroundService-ы)


Описание сервисов:

1. Генератор
-  постоянно генерирует события в случайное время в 2-секундном (например) интервале
  (т.е. в случайный промежуток времени - [время предыдущего события; время предыдущего события + 2 сек] - должно быть сгенерировано новое событие)
- имеет REST API (swagger) в котором в любой момент можно сгенерировать событие вручную 
- каждый раз, когда генерируется новое событие, он отсылает его через HTTP request Процессору 

2. Процессор
- имеет REST API (swagger) через которое принимает события и создает на их основе инциденты
- имеет БД в которую сохраняет созданные инциденты
  - инциденты создаются на основе 2-х шаблонов: простого и составного
- получая события, проверяет их на соответствие шаблонам
  - если событие соответствует шаблону - создается инцидент и записывается в БД
- имеет в REST API (swagger) метод для получения списка созданных инцидентов (sorting и pagination - опциональны, но будет плюсом)
- при этом, в списке сгенерированных инцидентов для каждого инцидента должен выводится список событий на основе которых он был создан



Описание сущностей:

- Событие:
Event
{
  Id: Guid,
  Type: EventTypeEnum: 1, 2, 3, 4 
  Time: DateTime (дата генерации события)
}

- Инцидент:
Incident 
{
  Id: Guid,
  Type: IncidentTypeEnum: 1, 2 
  Time: DateTime (дата создания инцидента)
}

- Шаблон
  1. Шаблон №1 (простой): если получено событие с Event.Type = 1 то создать инцидент 1 типа
  2. Шаблон №2 (составной): если получено событие с Event.Type = 2, а затем в течении 20 секунд (и не позже!) получено событие с Event.Type = 1, то создать инцидент с Incident.Type = 2, иначе создать инцидент Incident.Type = 1 на основе события с с Event.Type = 1
    2.1 составной шаблон описывает инцидент в котором участвуют несколько событий, он имеет временную границу
    2.2 составной шаблон имеет приоритет, если событие соответствует составному шаблону, оно не участвует в простом шаблоне №1
